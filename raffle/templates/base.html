{% load static %}
<!doctype html>
<html lang="es" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}Rifa Milo{% endblock %}</title>

  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    // CSRF para HTMX (lee cookie)
    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
    }
    document.addEventListener("htmx:configRequest", (e) => {
      const csrftoken = getCookie("csrftoken");
      if (csrftoken) e.detail.headers["X-CSRFToken"] = csrftoken;
    });
  </script>

  <link rel="icon" href="{% static 'img/favicon.ico' %}">
  <link rel="icon" type="image/png" sizes="32x32" href="{% static 'img/favicon-32x32.png' %}">
  <link rel="icon" type="image/png" sizes="16x16" href="{% static 'img/favicon-16x16.png' %}">
</head>

<body class="min-h-full bg-gray-50 text-gray-900">
  <div class="max-w-5xl mx-auto p-4">
    {% block content %}{% endblock %}
  </div>

  <!-- SDK Mercado Pago -->
  <script src="https://sdk.mercadopago.com/js/v2"></script>

  <!-- Copiar datos de transferencia -->
  <script>
  (function () {
    if (window.__transferCopyInit) return;
    window.__transferCopyInit = true;

    document.addEventListener("click", async function (ev) {
      const btn = ev.target.closest("[data-transfer-name]");
      if (!btn) return;

      const name = btn.dataset.transferName || "";
      const rut = btn.dataset.transferRut || "";
      const bank = btn.dataset.transferBank || "";
      const accountType = btn.dataset.transferAccountType || "";
      const accountNumber = btn.dataset.transferAccountNumber || "";
      const email = btn.dataset.transferEmail || "";

      const text = [
        name,
        rut,
        bank,
        accountType,
        accountNumber,
        email,
      ].join("\n");

      try {
        await navigator.clipboard.writeText(text);

        const wrapper = btn.closest(".transfer-data-block");
        const feedback = wrapper && wrapper.querySelector(".js-copy-feedback");
        if (feedback) {
          feedback.classList.remove("hidden");
          setTimeout(() => feedback.classList.add("hidden"), 2500);
        }
      } catch (e) {
        alert("No se pudieron copiar los datos. Copia manualmente, por favor.");
      }
    });
  })();
  </script>
  
  {% block extra_scripts %}{% endblock %}
</body>
</html>